<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Upload Image or PDF to Drive</title>

    <!-- Favicon -->
    <link
      rel="icon"
      href="https://drive.google.com/uc?export=view&id=19-CLvAzmU7885aL5zfLbcjwPvWNkxOJn"
      type="image/png"
    />

    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 0;
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;

        /* Background Image */
        background: url("https://images.unsplash.com/photo-1529070538774-1843cb3265df?auto=format&fit=crop&w=1920&q=80")
          no-repeat center center fixed;
        background-size: cover;
      }

      .card {
        background: rgba(255, 255, 255, 0.15);
        padding: 30px;
        border-radius: 16px;
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.25);
        max-width: 500px;
        width: 100%;
        text-align: center;
        backdrop-filter: blur(12px);
        border: 1px solid rgba(255, 255, 255, 0.3);
      }

      h2 {
        color: #fff;
        margin-bottom: 20px;
        font-weight: 600;
      }

      label {
        color: #fff;
        font-size: 14px;
      }

      input[type="file"],
      input[type="number"] {
        padding: 10px;
        margin-top: 8px;
        width: 100%;
        border-radius: 8px;
        border: none;
        outline: none;
        background: rgba(255, 255, 255, 0.85);
      }

      button {
        padding: 12px;
        margin-top: 12px;
        width: 100%;
        border-radius: 8px;
        border: none;
        cursor: pointer;
        font-size: 16px;
        font-weight: 600;
        transition: 0.3s;
      }

      #upload {
        background: linear-gradient(45deg, #007bff, #00d4ff);
        color: white;
        box-shadow: 0 4px 12px rgba(0, 123, 255, 0.4);
      }
      #upload:hover {
        background: linear-gradient(45deg, #0056b3, #0099cc);
        transform: scale(1.05);
      }

      #copyBtn {
        background: linear-gradient(45deg, #28a745, #4cd964);
        color: white;
        box-shadow: 0 4px 12px rgba(40, 167, 69, 0.4);
        display: none;
      }
      #copyBtn:hover {
        background: linear-gradient(45deg, #218838, #34c759);
        transform: scale(1.05);
      }

      #status {
        margin-top: 15px;
        padding: 12px;
        background: rgba(255, 255, 255, 0.2);
        border-radius: 6px;
        font-size: 14px;
        color: #fff;
        word-break: break-word;
      }

      #preview {
        margin-top: 15px;
        max-width: 100%;
        border-radius: 8px;
        display: none;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
      }

      /* Highlighted URL Box */
      .highlight {
        display: block;
        margin-top: 10px;
        padding: 10px;
        background: rgba(0, 0, 0, 0.6);
        color: #00ffea;
        font-weight: bold;
        border-radius: 6px;
        word-break: break-all;
        text-align: center;
      }
      .highlight a {
        color: #00ffea;
        text-decoration: none;
      }
      .highlight a:hover {
        text-decoration: underline;
      }
    </style>
  </head>
  <body>
    <div class="card">
      <h2>ðŸ“¤ Upload Image or PDF</h2>
      <input
        type="file"
        id="file"
        accept="image/*,application/pdf"
      /><br /><br />
      <label>
        Target image size (KB, only for images):
        <input type="number" id="targetKB" value="50" />
      </label>
      <br /><br />
      <button id="upload">ðŸš€ Upload</button>

      <div id="status"></div>
      <img id="preview" alt="preview" />
      <button id="copyBtn">ðŸ“‹ Copy URL</button>
    </div>

    <script>
      const WEB_APP_URL =
        "https://script.google.com/macros/s/AKfycbwA3YWME5f2bZFm_E9eGWrwHkzrlyU6fdTWOYJ3M1MD5D929Kk4l_vPS1JVeCBpb21c/exec";

      // Helpers
      function readImage(file) {
        return new Promise((resolve, reject) => {
          const fr = new FileReader();
          fr.onload = () => {
            const img = new Image();
            img.onload = () => resolve(img);
            img.onerror = reject;
            img.src = fr.result;
          };
          fr.onerror = reject;
          fr.readAsDataURL(file);
        });
      }
      function canvasToBlob(canvas, quality) {
        return new Promise((res) => canvas.toBlob(res, "image/jpeg", quality));
      }
      function blobToDataURL(blob) {
        return new Promise((res) => {
          const fr = new FileReader();
          fr.onload = () => res(fr.result);
          fr.readAsDataURL(blob);
        });
      }
      async function compress(file, maxBytes) {
        const img = await readImage(file);
        let w = img.width,
          h = img.height;
        const canvas = document.createElement("canvas");
        const ctx = canvas.getContext("2d");
        let quality = 0.9;
        while (true) {
          canvas.width = w;
          canvas.height = h;
          ctx.clearRect(0, 0, w, h);
          ctx.drawImage(img, 0, 0, w, h);
          const blob = await canvasToBlob(canvas, quality);
          if (blob.size <= maxBytes || quality < 0.3) return blob;
          quality -= 0.1;
          if (quality < 0.3) {
            w = Math.round(w * 0.9);
            h = Math.round(h * 0.9);
            quality = 0.9;
          }
        }
      }

      document.getElementById("upload").addEventListener("click", async () => {
        const file = document.getElementById("file").files[0];
        if (!file) return alert("Choose a file");

        const status = document.getElementById("status");
        status.innerText = "Processing...";

        try {
          let dataUrl;
          if (file.type.startsWith("image/")) {
            const maxBytes =
              (parseInt(document.getElementById("targetKB").value) || 50) *
              1024;
            const blob = await compress(file, maxBytes);
            dataUrl = await blobToDataURL(blob);
          } else if (file.type === "application/pdf") {
            dataUrl = await new Promise((resolve, reject) => {
              const fr = new FileReader();
              fr.onload = () => resolve(fr.result);
              fr.onerror = reject;
              fr.readAsDataURL(file);
            });
          } else {
            return alert("Unsupported file type");
          }

          const formData = new FormData();
          formData.append("dataUrl", dataUrl);
          formData.append("filename", file.name);
          formData.append("mimeType", file.type);

          status.innerText = "Uploading...";

          const res = await fetch(WEB_APP_URL, {
            method: "POST",
            body: formData,
          });

          if (!res.ok) throw new Error("Upload failed: " + res.status);
          const url = await res.text();

          // Highlighted box with link
          status.innerHTML =
            'âœ… Uploaded!<br><span class="highlight"><a href="' +
            url +
            '" target="_blank">' +
            url +
            "</a></span>";

          // Auto copy to clipboard
          navigator.clipboard.writeText(url);

          if (file.type.startsWith("image/")) {
            const preview = document.getElementById("preview");
            preview.src = url;
            preview.style.display = "block";
          }

          const copyBtn = document.getElementById("copyBtn");
          copyBtn.style.display = "inline-block";
          copyBtn.onclick = () => {
            navigator.clipboard.writeText(url);
            alert("URL copied!");
          };
        } catch (e) {
          status.innerText = "Error: " + e;
        }
      });
    </script>
  </body>
</html>
